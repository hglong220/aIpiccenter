# 🧪 测试指南

## ✅ 已完成的工作

### 1. 代码修复
- ✅ 修复了所有 TypeScript 编译错误
- ✅ 修复了 Prisma Client 导入路径
- ✅ 修复了 JWT 类型错误
- ✅ 修复了 AuthContext 类型错误
- ✅ 修复了微信支付回调类型错误
- ✅ 重新创建了 lib/gemini.ts 文件

### 2. 环境配置
- ✅ 创建了 .env.local 文件
- ✅ 生成了 Prisma Client
- ✅ 配置检查通过

## 🚀 测试步骤

### 1. 启动开发服务器

```bash
npm run dev
```

服务器将在 `http://localhost:3000` 启动

### 2. 测试用户注册/登录

1. **访问登录页面**
   - 打开浏览器访问 `http://localhost:3000/auth`
   - 应该看到登录/注册表单

2. **发送验证码**
   - 输入手机号（格式：1xxxxxxxxxx）
   - 点击"发送验证码"
   - **开发环境**：在终端/控制台查看验证码（会直接输出）

3. **完成注册**
   - 输入验证码
   - 可选：勾选"使用用户名注册"，输入用户名
   - 可选：输入密码
   - 点击"注册"
   - 应该成功注册并跳转到首页

4. **测试登录**
   - 在登录页面输入已注册的手机号
   - 发送验证码
   - 输入验证码完成登录

### 3. 测试用户账户页面

1. **访问账户页面**
   - 登录后，点击右上角用户菜单
   - 点击"我的账户"
   - 或直接访问 `http://localhost:3000/account`

2. **查看个人资料**
   - 应该看到用户信息、信用点、订阅计划
   - 点击"编辑"可以修改用户名和邮箱

3. **查看订单历史**
   - 切换到"订单历史"标签
   - 新用户应该显示"暂无订单"

4. **查看生成历史**
   - 切换到"生成历史"标签
   - 新用户应该显示"暂无生成记录"

### 4. 测试图像生成

1. **访问生成页面**
   - 登录后访问 `http://localhost:3000/generate`
   - 应该看到生成界面和当前信用点

2. **生成图像**
   - 输入提示词（例如："一只可爱的小猫"）
   - 可选：点击"增强提示"优化提示词
   - 可选：调整高级设置（尺寸、数量等）
   - 点击"生成"
   - 系统会检查信用点并扣除
   - 生成成功后显示结果

3. **查看生成记录**
   - 生成成功后，访问账户页面的"生成历史"
   - 应该看到刚才生成的记录

### 5. 测试支付流程

1. **访问定价页面**
   - 访问 `http://localhost:3000/pricing`
   - 应该看到所有定价方案

2. **选择计划**
   - 点击某个计划的"开始使用"按钮
   - 应该跳转到支付页面

3. **创建订单**
   - 支付页面会自动创建订单
   - 显示订单信息和支付金额
   - **注意**：需要配置微信支付才能完成支付

### 6. 测试 Header 用户菜单

1. **登录后**
   - 右上角应该显示用户信息（用户名或手机号后4位）
   - 点击可以打开用户菜单

2. **用户菜单功能**
   - 显示用户信息、信用点
   - "我的账户"链接
   - "退出登录"按钮

## ⚠️ 注意事项

### 开发环境

1. **短信验证码**
   - 验证码会在控制台/终端输出
   - 不会真正发送短信
   - 格式：`[开发环境] 发送验证码到 {phone}: {code}`

2. **微信支付**
   - 可以创建订单
   - 需要配置真实的微信支付才能完成支付
   - 开发环境可以使用模拟支付

3. **图像生成**
   - 使用模拟数据（picsum.photos）
   - 不会真正调用 Gemini API
   - 生成结果会保存到数据库

4. **数据库**
   - 需要先创建 PostgreSQL 数据库
   - 运行 `npm run db:push` 初始化数据库
   - 如果数据库不存在，某些功能会失败

### 常见问题

1. **数据库连接失败**
   - 检查 `.env.local` 中的 `DATABASE_URL`
   - 确保 PostgreSQL 服务正在运行
   - 检查数据库是否存在

2. **Prisma Client 未生成**
   ```bash
   npm run db:generate
   ```

3. **环境变量未加载**
   - 确保 `.env.local` 文件在项目根目录
   - 重启开发服务器

4. **TypeScript 错误**
   - 运行 `npx tsc --noEmit` 检查错误
   - 确保所有依赖已安装

## 📝 测试清单

- [ ] 用户注册功能
- [ ] 用户登录功能
- [ ] 用户账户页面
- [ ] 用户资料编辑
- [ ] 图像生成功能
- [ ] 信用点扣除
- [ ] 生成记录保存
- [ ] 订单创建
- [ ] Header 用户菜单
- [ ] 页面跳转和 redirect 参数

## 🎯 下一步

完成基本测试后，可以：
1. 配置真实的短信服务
2. 配置真实的微信支付
3. 配置真实的 Gemini API
4. 进行端到端测试
5. 性能测试
6. 安全测试





















