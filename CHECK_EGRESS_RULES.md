# 🔍 检查出站规则配置

## 当前状态

- ✅ IP 地址: `35.220.189.112` (已确认)
- ✅ Squid 服务: 运行中
- ✅ Squid 配置: 允许所有访问
- ❌ 代理连接: 仍然超时

## 🔧 需要检查：出站规则

### 在 GCP 控制台检查

1. **登录 GCP 控制台**
2. **导航到**: VPC 网络 > 防火墙
3. **查找出站规则**:
   - 查找名称包含 "egress" 或 "outbound" 的规则
   - 或查找允许 TCP 端口 3128 出站的规则

### 如果没有出站规则

需要创建一个出站规则：

1. **点击"创建防火墙规则"**
2. **配置规则**:
   - **名称**: `allow-squid-egress` 或类似名称
   - **方向**: **出站** (重要！)
   - **操作**: 允许
   - **目标**: 网络中的所有实例
   - **来源 IP 范围**: `0.0.0.0/0`
   - **协议和端口**: TCP，端口 `3128`
3. **点击"创建"**

### 如果已有出站规则

确认规则配置：
- ✅ 方向: 出站
- ✅ 协议: TCP
- ✅ 端口: 3128
- ✅ 状态: 启用

## ⏱️ 等待规则生效

创建或修改防火墙规则后，通常需要等待 **1-2 分钟** 才能生效。

## 🚀 重新测试

等待 1-2 分钟后，在国内服务器上重新测试：

```powershell
$env:HTTPS_PROXY = "http://35.220.189.112:3128"
Invoke-WebRequest -Uri "https://www.google.com" -Proxy $env:HTTPS_PROXY -Method Head
```

## 📝 其他可能的问题

如果出站规则已正确配置，但仍然失败，可能的原因：

1. **网络路由问题**: VM 实例可能无法访问外部网络
2. **Squid 监听地址**: 确认 Squid 监听所有接口
   ```bash
   sudo grep "http_port" /etc/squid/squid.conf
   ```
   应该看到 `http_port 3128` 或 `http_port 0.0.0.0:3128`

3. **查看 Squid 日志**: 
   ```bash
   sudo tail -f /var/log/squid/access.log
   ```
   然后在国内服务器上测试，看是否有连接记录

---

**关键**: 确保创建了**出站**方向的防火墙规则！


