# 2. 架构图

## 系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                        前端层 (Next.js)                      │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │
│  │  首页    │  │ 生成页面 │  │ 项目管理 │  │ 后台管理 │ │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                    API层 (Next.js API Routes)                │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │
│  │ AI路由   │  │ 视频生成 │  │ 文件上传 │  │ 内容审核 │ │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │
└─────────────────────────────────────────────────────────────┘
                            │
        ┌───────────────────┼───────────────────┐
        ▼                   ▼                   ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│  任务队列    │  │  存储层      │  │  AI服务      │
│  (内存队列)  │  │  (本地/S3)   │  │  (Gemini等)  │
└──────────────┘  └──────────────┘  └──────────────┘
        │                   │                   │
        ▼                   ▼                   ▼
┌─────────────────────────────────────────────────────────────┐
│                      数据层 (Prisma + SQLite)                │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │
│  │ 用户表   │  │ 任务表   │  │ 文件表   │  │ 项目表   │ │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │
└─────────────────────────────────────────────────────────────┘
```

## 组件说明

### 前端层
- **框架**: Next.js 14 App Router
- **UI库**: React 18 + Tailwind CSS
- **状态管理**: Zustand
- **状态**: ✅ 已实现

### API层
- **框架**: Next.js API Routes
- **认证**: JWT Token
- **限流**: 内存LRU缓存
- **状态**: ✅ 已实现

### 任务队列
- **实现**: 内存队列 (TaskQueue类)
- **持久化**: ❌ 未实现 (重启会丢失)
- **建议**: 集成Redis/BullMQ
- **状态**: ⚠️ 部分实现

### 存储层
- **当前**: 本地文件系统
- **支持**: S3/R2/OSS/MinIO (框架已实现)
- **状态**: ✅ 已实现抽象层，待配置

### AI服务
- **Gemini**: ✅ 已集成
- **GPT**: ⚠️ 框架已实现，待配置
- **视频生成**: ⚠️ 框架已实现，待配置
- **状态**: ⚠️ 部分实现

### 数据层
- **ORM**: Prisma
- **数据库**: SQLite (开发) / PostgreSQL (生产建议)
- **迁移**: ✅ 已配置
- **状态**: ✅ 已实现

